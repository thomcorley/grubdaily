<% content_for :head do %>
  <link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">
  <script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
  <meta name="turbolinks-cache-control" content="no-cache">
<% end %>

<section class="delicious">
  <main role="main">
    <section class="index" itemscope itemtype="http://schema.org/Blog">
      <section class="newest-recipes clear">

        <div class="main-carousel">
          <% @entries_for_carousel.each do |entry| %>
            <div class="carousel-cell">
              <a itemprop="url" href="<%= entry.permalink %>">
                <img class="carousel-image" src="<%= asset_path(entry.image) %>" alt="<%= entry.title %>"/>
              </a>
            </div>
          <% end %>
        </div>

        <div id="subscribed" style="display: none"></div>
      </section>

      <section class="photo-gallery clear">
        <div class="section-title">
          <span>Recent Entries</span>
        </div>
        </br>

        <div class="gallery">
          <% @recent_entries.each do |recipe| %>
            <figure class=”gallery__item gallery__item--1">
              <a href="<%= recipe.permalink %>" title="<%= recipe.title %>">
                <img src="<%= asset_path(recipe.image) %>" class="gallery__img" alt="<%= recipe.title %>">
              </a>
            </figure>
          <% end %>
        </div>
      </section>

      <section class="subscribe-form clear">
        <%= form_with model: @email_subscriber, url: email_subscribers_path do |form| %>
          <div class="field has-addons is-justify-content-center">
            <div class="control">
                <%= form.email_field :email, class: "input is-medium email-field", placeholder: "Email me tasty things!" %>
            </div>
            <div class="control">
                <%= form.submit value: "Go", class: "button is-medium submit-button" %>
            </div>
          </div>

          <% if flash[:validation_error] %>
            <div class="notice"><%= flash[:validation_error].sub("Validation failed: Email", "Error: email") %></div>
          <% end %>
        <% end %>
      </section>

      <section class="posts clear bottom-panel" style="margin-bottom: 80px;">
        <div class="social clear">
          <a href="https://facebook.com/grubdaily"><%= render "facebook_icon" %></a>
          <a href="twitter.com/grubdaily_tom"><%= render "twitter_icon" %></a>
          <a href="https://www.instagram.com/grubdaily"><%= render "instagram_icon" %></a>
          <a href="https://www.pinterest.co.uk/grubdaily"><%= render "pinterest_icon" %></a>
        </div>
      </section>
    </section>
  </main>
</section>

<script>
  document.addEventListener("turbolinks:load", function() {
    const carouselElement = document.querySelector(".main-carousel");
    const flkty = new Flickity( carouselElement, {
        lazyLoad: true,
        resize: true,
        setGallerySize: true,
        autoPlay: 3000,
        autoPlay: 5000,
        wrapAround: true
    });
  });
</script>
